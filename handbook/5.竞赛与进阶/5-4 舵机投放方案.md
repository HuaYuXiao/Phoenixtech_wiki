# 舵机投放方案

## 白嫖嘉立创打板

### 下载工程文件

[点我下载工程文件压缩包](https://wwcm.lanzoue.com/iDQwr2lx5zbi)

下载后解压得到epro文件

### 下载嘉立创EDA专业版

https://pro.lceda.cn/

### 导入专业版

![](assets/2.png)

选择刚刚解压的epro文件

### 下单

![](assets/3.png)

点击下单嘉立创，在嘉立创领劵可以免费打板

## 焊接板子和排针

焊上单片机和排针，注意方向，是直接盖在上面的文字上面

![](assets/4.png)

板子使用arduino none，购买2.54mm间距3x6P（只用三个买3x3P也可）

### 烧录与接线

在ubuntu上安装arduino和依赖，烧录`servo.ino`到单片机中

`servo.ino`文件如下

```
#include <Servo.h>
#include <ros.h>
#include <geometry_msgs/Point.h>

// 定义舵机引脚
#define SERVO_PIN_1 3
#define SERVO_PIN_2 5
#define SERVO_PIN_3 6

// 创建ROS节点
ros::NodeHandle nh;

// 创建舵机对象
Servo servo1;
Servo servo2;
Servo servo3;

// 订阅的消息回调函数
void messageCallback(const geometry_msgs::Point& msg)
{
  // 获取接收到的旋转目标角度
  int angle1 = msg.x; // 对应舵机1的旋转角度
  int angle2 = msg.y; // 对应舵机2的旋转角度
  int angle3 = msg.z; // 对应舵机3的旋转角度

  // 控制舵机旋转到指定角度
  servo1.write(angle1);

  servo2.write(angle2);

  servo3.write(angle3);
}

// 创建订阅对象
ros::Subscriber<geometry_msgs::Point> sub("/arduino_ros", &messageCallback);

void setup()
{
  // 初始化舵机引脚
  servo1.attach(SERVO_PIN_1);
  servo2.attach(SERVO_PIN_2);
  servo3.attach(SERVO_PIN_3);

  // 初始化ROS节点
  nh.initNode();
  nh.subscribe(sub);
}

void loop()
{
  // 处理ROS消息
  nh.spinOnce();
  delay(10);
}
```

接入舵机线，靠近单片机的一侧是信号线（黄色）

![](assets/5.png)

## 启动指令

安装依赖

```
sudo apt update
sudo apt install ros-noetic-rosserial
```

使用数据线连接电脑与单片机

启动下面三个指令

```
roscore
```

```
rosrun rosserial_python serial_node.py _port:=/dev/ttyUSB0 _baud:=57600
```

```
rosrun serial_handle servo_test.py
```

servo_test.py程序如下，输入`0 180`，对应第三pin转到180；输入`a 180`，使三个舵机全转到180；输入q退出

```
      
#!/usr/bin/env python

import rospy
from geometry_msgs.msg import Point

def main():
    rospy.init_node('interactive_point_publisher')
    pub = rospy.Publisher('/arduino_ros', Point, queue_size=10)

    point = Point()
    
    while not rospy.is_shutdown():
        try:
            user_input = input("Enter coordinate (e.g., '0 180' or 'q' to quit): ")
            
            if user_input.lower() == 'q':
                print("Quitting...")
                break
            
            axis, value = user_input.split()
            value = float(value)
            
            if axis.lower() == '0':
                point.x = value
            elif axis.lower() == '1':
                point.y = value
            elif axis.lower() == '2':
                point.z = value
            elif axis.lower() == 'a':
                point.x = value
                point.y = value
                point.z = value
            else:
                print("Invalid axis. Please enter '0', '1', '2' or 'a'.")
                continue
            
            pub.publish(point)
            rospy.loginfo(f"Published: 0={point.x}, 1={point.y}, 2={point.z}")
        
        except ValueError:
            print("Invalid input. Please enter in the format 'axis value'.")
        except rospy.ROSInterruptException:
            break

if __name__ == '__main__':
    main()
```

